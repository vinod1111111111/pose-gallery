<script type="module">
  const imageContainer = document.getElementById('imageContainer');
  const errorMessage = document.getElementById('errorMessage');
  const generateImageBtn = document.getElementById('generateImageBtn');
  const searchInput = document.getElementById('searchInput');

  async function generateImage() {
    imageContainer.innerHTML = '<div class="loading-spinner"></div>';
    errorMessage.classList.add('hidden');
    generateImageBtn.disabled = true;

    const query = searchInput.value.trim();
    const defaultPrompt = "A woman posing in various iconic styles, including seated, fashion, dance, and hand-on-hip. Clean white background, studio-lit.";
    const prompt = query
      ? `A woman demonstrating the '${query}' pose, professional lighting, minimal background.`
      : defaultPrompt;

    const payload = {
      instances: [{ prompt }],
      parameters: { sampleCount: 1 }
    };

    const apiKey = "AIzaSyAtQMUI7F0t4y2vOaVgG2mjVbYFvsSRRtA"; // ← ఇక్కడ మీ API key
    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;

    if (!apiKey || apiKey.includes("PASTE_YOUR_API_KEY_HERE")) {
      imageContainer.innerHTML = '';
      errorMessage.textContent = 'API key missing. Please configure it.';
      errorMessage.classList.remove('hidden');
      generateImageBtn.disabled = false;
      return;
    }

    try {
      const response = await fetch(apiUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });

      const result = await response.json();

      if (result.predictions && result.predictions[0]?.bytesBase64Encoded) {
        const imageUrl = `data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`;
        imageContainer.innerHTML = `<img src="${imageUrl}" alt="Generated pose">`;
      } else {
        throw new Error('No image returned');
      }
    } catch (error) {
      errorMessage.textContent = 'Image generation failed.';
      errorMessage.classList.remove('hidden');
      imageContainer.innerHTML = '';
      console.error("Error:", error);
    } finally {
      generateImageBtn.disabled = false;
    }
  }

  window.onload = generateImage;
  generateImageBtn.addEventListener('click', generateImage);
</script>
